Many	O
years	O
ago	O
,	O
to	O
provide	O
an	O
age	O
calculator	O
gimmick	O
on	O
my	O
website	O
,	O
I	O
wrote	O
a	O
function	O
to	O
calculate	O
age	O
to	O
a	O
fraction	O
.	O
This	O
is	O
a	O
quick	O
port	O
of	O
that	O
function	O
to	O
C	O
#	O
(	O
from	O
the	O
PHP	O
version	O
)	O
.	O
I	O
'm	O
afraid	O
I	O
have	O
n't	O
been	O
able	O
to	O
test	O
the	O
C	O
#	O
version	O
,	O
but	O
hope	O
you	O
enjoy	O
all	O
the	O
same	O
!	O
(	O
Admittedly	O
this	O
is	O
a	O
bit	O
gimmicky	O
for	O
the	O
purposes	O
of	O
showing	O
user	O
profiles	O
on	O
Stack	O
Overflow	O
,	O
but	O
maybe	O
readers	O
will	O
find	O
some	O
use	O
for	O
it	O
.	O
:	O
-	O
)	O
)	O
double	O
AgeDiff	O
(	O
DateTime	O
date1	O
,	O
DateTime	O
date2	O
)	O
{	O
double	O
years	O
=	O
date2.Year	O
-	O
date1.Year	O
;	O
/*	O
*	O
If	O
date2	O
and	O
date1	O
+	O
round	O
(	O
date2	O
-	O
date1	O
)	O
are	O
on	O
different	O
sides	O
*	O
of	O
29	O
February	O
,	O
then	O
our	O
partial	O
year	O
is	O
considered	O
to	O
have	O
366	O
*	O
days	O
total	O
,	O
otherwise	O
it	O
's	O
365	O
.	O
Note	O
that	O
59	O
is	O
the	O
day	O
number	O
*	O
of	O
29	O
Feb.	O
*/	O
double	O
fraction	O
=	O
365	O
+	O
(	O
DateTime.IsLeapYear	O
(	O
date2.Year	O
)	O
date2.DayOfYear	O
=	O
59	O
(	O
date1.DayOfYear	O
59	O
||	O
date1.DayOfYear	O
date2.DayOfYear	O
)	O
?	O
1	O
:	O
0	O
)	O
;	O
/*	O
*	O
The	O
only	O
really	O
nontrivial	O
case	O
is	O
if	O
date1	O
is	O
in	O
a	O
leap	O
year	O
,	O
*	O
and	O
date2	O
is	O
not	O
.	O
So	O
let	O
's	O
handle	O
the	O
others	O
first	O
.	O
*/	O
if	O
(	O
DateTime.IsLeapYear	O
(	O
date2.Year	O
)	O
==	O
DateTime.IsLeapYear	O
(	O
date1.Year	O
)	O
)	O
return	O
years	O
+	O
(	O
date2.DayOfYear	O
-	O
date1.DayOfYear	O
)	O
/	O
fraction	O
;	O
/*	O
*	O
If	O
date2	O
is	O
in	O
a	O
leap	O
year	O
,	O
but	O
date1	O
is	O
not	O
and	O
is	O
March	O
or	O
*	O
beyond	O
,	O
shift	O
up	O
by	O
a	O
day	O
.	O
*/	O
if	O
(	O
DateTime.IsLeapYear	O
(	O
date2.Year	O
)	O
)	O
{	O
return	O
years	O
+	O
(	O
date2.DayOfYear	O
-	O
date1.DayOfYear	O
-	O
(	O
date1.DayOfYear	O
=	O
59	O
?	O
1	O
:	O
0	O
)	O
)	O
/	O
fraction	O
;	O
}	O
/*	O
*	O
If	O
date1	O
is	O
not	O
on	O
29	O
February	O
,	O
shift	O
down	O
date1	O
by	O
a	O
day	O
if	O
*	O
March	O
or	O
later	O
.	O
Proceed	O
normally	O
.	O
*/	O
if	O
(	O
date1.DayOfYear	O
!	O
=	O
59	O
)	O
{	O
return	O
years	O
+	O
(	O
date2.DayOfYear	O
-	O
date1.DayOfYear	O
+	O
(	O
date1.DayOfYear	O
59	O
?	O
1	O
:	O
0	O
)	O
)	O
/	O
fraction	O
;	O
}	O
/*	O
*	O
Okay	O
,	O
here	O
date1	O
is	O
on	O
29	O
February	O
,	O
and	O
date2	O
is	O
not	O
on	O
a	O
leap	O
*	O
year	O
.	O
What	O
to	O
do	O
now	O
?	O
On	O
28	O
Feb	O
in	O
date2	O
's	O
year	O
,	O
the	O
``	O
age	O
''	O
*	O
should	O
be	O
just	O
shy	O
of	O
a	O
whole	O
number	O
,	O
and	O
on	O
1	O
Mar	O
should	O
be	O
*	O
just	O
over	O
.	O
Perhaps	O
the	O
easiest	O
way	O
is	O
to	O
a	O
point	O
halfway	O
*	O
between	O
those	O
two	O
:	O
58.5	O
.	O
*/	O
return	O
years	O
+	O
(	O
date2.DayOfYear	O
-	O
58.5	O
)	O
/	O
fraction	O
;	O
}	O
