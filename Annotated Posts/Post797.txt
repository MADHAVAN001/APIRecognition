First	O
,	O
create	O
a	O
function	O
(	O
using	O
CTE	O
,	O
common	O
table	O
expression	O
does	O
away	O
with	O
the	O
need	O
for	O
a	O
temp	O
table	O
)	O
create	O
function	O
dbo.SplitString	O
(	O
@	O
str	O
nvarchar	O
(	O
4000	O
)	O
,	O
@	O
separator	O
char	O
(	O
1	O
)	O
)	O
returns	O
table	O
AS	O
return	O
(	O
with	O
tokens	O
(	O
p	O
,	O
a	O
,	O
b	O
)	O
AS	O
(	O
select	O
1	O
,	O
1	O
,	O
charindex	O
(	O
@	O
separator	O
,	O
@	O
str	O
)	O
union	O
all	O
select	O
p	O
+	O
1	O
,	O
b	O
+	O
1	O
,	O
charindex	O
(	O
@	O
separator	O
,	O
@	O
str	O
,	O
b	O
+	O
1	O
)	O
from	O
tokens	O
where	O
b	O
0	O
)	O
select	O
p-1	O
zeroBasedOccurance	O
,	O
substring	O
(	O
@	O
str	O
,	O
a	O
,	O
case	O
when	O
b	O
0	O
then	O
b-a	O
ELSE	O
4000	O
end	O
)	O
AS	O
s	O
from	O
tokens	O
)	O
GO	O
Then	O
,	O
use	O
it	O
as	O
any	O
table	O
(	O
or	O
modify	O
it	O
to	O
fit	O
within	O
your	O
existing	O
stored	O
proc	O
)	O
like	O
this	O
.	O
select	O
s	O
from	O
dbo.SplitString	O
(	O
'Hello	O
John	O
Smith	O
'	O
,	O
'	O
'	O
)	O
where	O
zeroBasedOccurance=1	O
Update	O
Previous	O
version	O
would	O
fail	O
for	O
input	O
string	O
longer	O
than	O
4000	O
chars	O
.	O
This	O
version	O
takes	O
care	O
of	O
the	O
limitation	O
:	O
create	O
function	O
dbo.SplitString	O
(	O
@	O
str	O
nvarchar	O
(	O
max	O
)	O
,	O
@	O
separator	O
char	O
(	O
1	O
)	O
)	O
returns	O
table	O
AS	O
return	O
(	O
with	O
tokens	O
(	O
p	O
,	O
a	O
,	O
b	O
)	O
AS	O
(	O
select	O
cast	O
(	O
1	O
as	O
bigint	O
)	O
,	O
cast	O
(	O
1	O
as	O
bigint	O
)	O
,	O
charindex	O
(	O
@	O
separator	O
,	O
@	O
str	O
)	O
union	O
all	O
select	O
p	O
+	O
1	O
,	O
b	O
+	O
1	O
,	O
charindex	O
(	O
@	O
separator	O
,	O
@	O
str	O
,	O
b	O
+	O
1	O
)	O
from	O
tokens	O
where	O
b	O
0	O
)	O
select	O
p-1	O
ItemIndex	O
,	O
substring	O
(	O
@	O
str	O
,	O
a	O
,	O
case	O
when	O
b	O
0	O
then	O
b-a	O
ELSE	O
LEN	O
(	O
@	O
str	O
)	O
end	O
)	O
AS	O
Item	O
from	O
tokens	O
)	O
;	O
GO	O
Usage	O
remains	O
the	O
same	O
.	O
